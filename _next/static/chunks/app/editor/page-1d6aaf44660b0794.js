(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[766],{6104:(e,t,l)=>{"use strict";l.r(t),l.d(t,{default:()=>d});var a=l(5155),i=l(2115),n=l(944),r=l(828),s=l.n(r),o=l(4417),c=l(6167);function d(){let[e,t]=(0,i.useState)("/fantasy-map.png"),[l]=s()(e,"anonymous"),r=(0,i.useRef)(null),d=(0,i.useRef)(null),[u,m]=(0,i.useState)(null),[g,h]=(0,i.useState)([]),[p,x]=(0,i.useState)([]),[f,b]=(0,i.useState)([]),y=(0,i.useRef)(1),[w,j]=(0,i.useState)(null),[N,v]=(0,i.useState)(null),[k,C]=(0,i.useState)(!1),[A,R]=(0,i.useState)({name:"",lore:"",color:"#f59e0b",link:""}),[S,D]=(0,i.useState)(1);async function M(e){var l;let a=null==(l=e.target.files)?void 0:l[0];if(!a)return;let i=new FileReader;i.onload=()=>t(i.result),i.readAsDataURL(a)}function I(){if(!d.current)return null;try{return d.current.getClientRect()}catch(e){return null}}return(0,i.useEffect)(()=>{x([{id:y.current++,name:"Mystwood",lore:"Ancient forest filled with magical creatures.Ancient forest filled with magical creatures.Ancient forest filled with magical creatures.Ancient forest filled with magical creatures.Ancient forest filled with magical creatures.Ancient forest filled with magical creatures.Ancient forest filled with magical creatures.Ancient forest filled with magical creatures.Ancient forest filled with magical creatures.Ancient forest filled with magical creatures.Ancient forest filled with magical creatures.Ancient forest filled with magical creatures.Ancient forest filled with magical creatures.Ancient forest filled with magical creatures.Ancient forest filled with magical creatures.Ancient forest filled with magical creatures.Ancient forest filled with magical creatures.Ancient forest filled with magical creatures.Ancient forest filled with magical creatures.Ancient forest filled with magical creatures.",color:"#16a34a",pointsPercent:[[20,20],[40,25],[30,45]],link:"https://example.com/mystwood"}]),b([{id:y.current++,name:"Dragonspire",lore:"A bustling city of dragons",x:60,y:40,link:"https://example.com/dragonspire"}])},[]),(0,a.jsxs)("div",{className:"space-y-4 p-4",children:[(0,a.jsxs)("div",{className:"flex flex-wrap gap-2 p-3 bg-black/50 backdrop-blur-md rounded-lg shadow-md",children:[(0,a.jsxs)("label",{className:"bg-indigo-600 hover:bg-indigo-500 transition px-3 py-1 rounded text-white cursor-pointer",children:["Upload Map",(0,a.jsx)("input",{type:"file",accept:"image/*",className:"hidden",onChange:M})]}),(0,a.jsx)("button",{onClick:function(){m("draw"),h([]),C(!1)},className:"px-3 py-1 rounded bg-purple-700 hover:bg-purple-600 text-white transition",children:"Draw Region"}),(0,a.jsx)("button",{onClick:()=>{"draw"===u&&g.length>=3?C(!0):alert("Draw at least 3 points first.")},className:"px-3 py-1 rounded bg-purple-700 hover:bg-purple-600 text-white transition",children:"Finish Region"}),(0,a.jsx)("button",{onClick:function(){m("marker")},className:"px-3 py-1 rounded bg-green-600 hover:bg-green-500 text-white transition",children:"Add Marker"}),(0,a.jsx)("button",{onClick:()=>m(null),className:"px-3 py-1 rounded bg-gray-700 hover:bg-gray-600 text-white transition",children:"Cancel Mode"}),(0,a.jsx)("button",{onClick:function(){g.length>0&&h(e=>e.slice(0,-1))},className:"px-3 py-1 rounded bg-gray-700 hover:bg-gray-600 text-white transition",children:"Undo Last Point"}),(0,a.jsx)("button",{onClick:function(){x(e=>e.slice(0,-1))},className:"px-3 py-1 rounded bg-gray-700 hover:bg-gray-600 text-white transition",children:"Undo Last Region"}),(0,a.jsx)("button",{onClick:function(){let t=new Blob([JSON.stringify({mapImage:e,locations:f,regions:p},null,2)],{type:"application/json"}),l=URL.createObjectURL(t),a=document.createElement("a");a.href=l,a.download="fantasy-map-export.json",a.click(),URL.revokeObjectURL(l)},className:"px-3 py-1 rounded bg-indigo-600 hover:bg-indigo-500 text-white transition",children:"Export JSON"}),(0,a.jsxs)("label",{className:"bg-indigo-600 hover:bg-indigo-500 transition px-3 py-1 rounded text-white cursor-pointer",children:["Import JSON",(0,a.jsx)("input",{type:"file",accept:".json",className:"hidden",onChange:e=>(function(e){let l=new FileReader;l.onload=()=>{try{let e=JSON.parse(l.result);e.mapImage&&t(e.mapImage),Array.isArray(e.locations)&&b(e.locations),Array.isArray(e.regions)&&x(e.regions),alert("Imported successfully")}catch(e){alert("Invalid JSON file")}},l.readAsText(e)})(e.target.files[0])})]})]}),(0,a.jsxs)("div",{className:"bg-gray-900 p-4 rounded-lg shadow-inner relative",children:[(0,a.jsx)(o.GT,{children:(0,a.jsx)(o.WZ,{children:(0,a.jsx)("div",{style:{width:1e3*S,margin:"0 auto"},children:(0,a.jsx)(n.BI,{width:1e3*S,height:600*S,onMouseDown:function(e){let t=r.current;if(!t)return;let l=t.getPointerPosition(),a=I();if(!a||l.x<a.x||l.y<a.y||l.x>a.x+a.width||l.y>a.y+a.height)return;let i=l.x-a.x,n=l.y-a.y;if("draw"===u)h(e=>[...e,[i,n]]);else if("marker"===u){let e=[i/a.width*100,n/a.height*100];b(t=>[...t,{id:y.current++,name:"New Location",lore:"",x:e[0],y:e[1],link:""}]),m(null)}},ref:r,children:(0,a.jsxs)(n.Wd,{children:[(0,a.jsx)(n._V,{image:l,x:0,y:0,width:1e3*S,height:600*S,ref:d}),p.map(e=>(0,a.jsxs)(n.YJ,{children:[(0,a.jsx)(n.N1,{points:function(e){let t=I();return t?e.flatMap(e=>[e[0]/100*t.width+t.x,e[1]/100*t.height+t.y]):[]}(e.pointsPercent),closed:!0,stroke:e.color,fill:e.color,opacity:.35,strokeWidth:2,onClick:t=>{t.cancelBubble=!0,j(e.id),v(null)},className:"transition-all"}),w===e.id&&e.pointsPercent.map((t,l)=>{let i=I();if(!i)return null;let r=t[0]/100*i.width+i.x,s=t[1]/100*i.height+i.y;return(0,a.jsx)(n.jl,{x:r,y:s,radius:6,fill:"#facc15",stroke:"#fbbf24",draggable:!0,onDragMove:t=>(function(e,t,l){let a=I();if(!a)return;let i=[(l[0]-a.x)/a.width*100,(l[1]-a.y)/a.height*100];x(l=>l.map(l=>l.id===e?{...l,pointsPercent:l.pointsPercent.map((e,l)=>l===t?i:e)}:l))})(e.id,l,[t.target.x(),t.target.y()])},l)})]},e.id)),g.length>0&&(0,a.jsx)(n.N1,{points:g.flat(),stroke:"#f59e0b",strokeWidth:2}),g.map((e,t)=>(0,a.jsx)(n.jl,{x:e[0],y:e[1],radius:4,fill:"#fff",stroke:"#000"},t)),f.map(e=>{let t=I();if(!t)return null;let l=e.x/100*t.width+t.x,i=e.y/100*t.height+t.y;return(0,a.jsx)(n.jl,{x:l,y:i,radius:8,fill:"red",stroke:"white",draggable:!0,onDragEnd:t=>(function(e,t){let l=e.target.position(),a=I();if(!a)return;let i=(l.x-a.x)/a.width*100,n=(l.y-a.y)/a.height*100;b(e=>e.map(e=>e.id===t?{...e,x:Math.max(0,Math.min(100,i)),y:Math.max(0,Math.min(100,n))}:e))})(t,e.id),onClick:t=>{t.cancelBubble=!0,v(e.id),j(null)},className:"shadow-lg transition-transform hover:scale-125"},e.id)})]})})})})}),(0,a.jsxs)("div",{className:"absolute right-4 top-6 w-80 bg-black/50 backdrop-blur-md p-3 rounded-lg shadow-lg z-30 text-white text-sm",children:[(0,a.jsx)("h4",{className:"font-semibold mb-2",children:"Items"}),(0,a.jsxs)("div",{className:"space-y-2",children:[(0,a.jsx)("div",{className:"font-medium",children:"Regions"}),p.map(e=>(0,a.jsxs)("div",{className:"flex justify-between items-center p-1 hover:bg-white/10 rounded cursor-pointer",onClick:()=>j(e.id),children:[(0,a.jsx)("div",{children:e.name}),(0,a.jsx)("div",{style:{width:14,height:14,background:e.color},className:"rounded-full border"})]},e.id)),(0,a.jsx)("div",{className:"font-medium mt-2",children:"Markers"}),f.map(e=>(0,a.jsx)("div",{className:"flex justify-between items-center p-1 hover:bg-white/10 rounded cursor-pointer",onClick:()=>v(e.id),children:e.name},e.id))]}),(w||N)&&(0,a.jsxs)("div",{className:"mt-3 pt-2 border-t border-white/20",children:[(0,a.jsx)("h5",{className:"font-semibold mb-2",children:"Edit Item"}),w&&(()=>{let e=p.find(e=>e.id===w);return e?(0,a.jsxs)("div",{className:"space-y-1",children:[(0,a.jsx)("input",{className:"w-full p-2 rounded bg-gray-800 text-sm",value:e.name,onChange:t=>x(l=>l.map(l=>l.id===e.id?{...l,name:t.target.value}:l))}),(0,a.jsx)("textarea",{className:"w-full p-2 rounded bg-gray-800 text-sm",value:e.lore,onChange:t=>x(l=>l.map(l=>l.id===e.id?{...l,lore:t.target.value}:l))}),(0,a.jsx)("input",{type:"color",className:"w-full p-1 rounded bg-gray-800",value:e.color,onChange:t=>x(l=>l.map(l=>l.id===e.id?{...l,color:t.target.value}:l))}),(0,a.jsx)("input",{type:"url",className:"w-full p-2 rounded bg-gray-800 text-sm",value:e.link||"",onChange:t=>x(l=>l.map(l=>l.id===e.id?{...l,link:t.target.value}:l)),placeholder:"https://example.com"}),(0,a.jsxs)("div",{className:"flex gap-2",children:[(0,a.jsx)("button",{onClick:()=>j(null),className:"px-3 py-1 rounded bg-gray-700",children:"Done"}),(0,a.jsx)("button",{onClick:()=>x(t=>t.filter(t=>t.id!==e.id)),className:"px-3 py-1 rounded bg-red-500 text-white",children:"Delete"})]})]}):null})(),N&&(()=>{let e=f.find(e=>e.id===N);return e?(0,a.jsxs)("div",{className:"space-y-1",children:[(0,a.jsx)("input",{className:"w-full p-2 rounded bg-gray-800 text-sm",value:e.name,onChange:t=>b(l=>l.map(l=>l.id===e.id?{...l,name:t.target.value}:l))}),(0,a.jsx)("textarea",{className:"w-full p-2 rounded bg-gray-800 text-sm",value:e.lore,onChange:t=>b(l=>l.map(l=>l.id===e.id?{...l,lore:t.target.value}:l))}),(0,a.jsx)("input",{type:"url",className:"w-full p-2 rounded bg-gray-800 text-sm",value:e.link||"",onChange:t=>b(l=>l.map(l=>l.id===e.id?{...l,link:t.target.value}:l)),placeholder:"https://example.com"}),(0,a.jsxs)("div",{className:"flex gap-2",children:[(0,a.jsx)("button",{onClick:()=>v(null),className:"px-3 py-1 rounded bg-gray-700",children:"Done"}),(0,a.jsx)("button",{onClick:()=>b(t=>t.filter(t=>t.id!==e.id)),className:"px-3 py-1 rounded bg-red-500 text-white",children:"Delete"})]})]}):null})()]})]})]}),(0,a.jsxs)("div",{className:"bg-gray-900 p-4 rounded-lg shadow-md",children:[(0,a.jsx)("h3",{className:"font-semibold mb-2 text-indigo-400",children:"Viewer Preview"}),(0,a.jsx)(c.A,{mapImage:e,locations:f,regions:p})]}),k&&(0,a.jsx)("div",{className:"fixed inset-0 bg-black/50 flex items-center justify-center z-60",children:(0,a.jsxs)("div",{className:"bg-gray-900/90 backdrop-blur-md p-5 rounded-2xl w-96 shadow-2xl text-white",children:[(0,a.jsx)("h3",{className:"font-semibold mb-2 text-indigo-300",children:"Region Details"}),(0,a.jsx)("label",{className:"block mb-1 text-sm",children:"Name"}),(0,a.jsx)("input",{className:"w-full p-2 mb-2 rounded bg-gray-800 text-sm",value:A.name,onChange:e=>R(t=>({...t,name:e.target.value}))}),(0,a.jsx)("label",{className:"block mb-1 text-sm",children:"Lore"}),(0,a.jsx)("textarea",{className:"w-full p-2 mb-2 rounded bg-gray-800 text-sm",value:A.lore,onChange:e=>R(t=>({...t,lore:e.target.value})),rows:4}),(0,a.jsx)("label",{className:"block mb-1 text-sm",children:"Link"}),(0,a.jsx)("input",{type:"url",className:"w-full p-2 mb-2 rounded bg-gray-800 text-sm",placeholder:"https://example.com",value:A.link,onChange:e=>R(t=>({...t,link:e.target.value}))}),(0,a.jsx)("label",{className:"block mb-1 text-sm",children:"Color"}),(0,a.jsx)("input",{type:"color",className:"w-full p-2 mb-3 rounded bg-gray-800",value:A.color,onChange:e=>R(t=>({...t,color:e.target.value}))}),(0,a.jsxs)("div",{className:"flex gap-2 justify-end",children:[(0,a.jsx)("button",{className:"px-3 py-1 rounded bg-gray-700",onClick:()=>{C(!1),h([])},children:"Cancel"}),(0,a.jsx)("button",{className:"px-3 py-1 rounded bg-indigo-600 text-white",onClick:function(){if(g.length<3)return alert("Need at least 3 points to create a region.");let e=I();if(!e)return alert("Image not ready");let t=g.map(t=>[t[0]/e.width*100,t[1]/e.height*100]);x(e=>[...e,{id:y.current++,name:A.name||"Region",lore:A.lore,color:A.color,pointsPercent:t,link:A.link||""}]),h([]),m(null),C(!1),R({name:"",lore:"",color:"#f59e0b",link:""})},children:"Save Region"})]})]})})]})}},8349:(e,t,l)=>{Promise.resolve().then(l.bind(l,6104))}},e=>{e.O(0,[413,733,886,135,167,441,255,358],()=>e(e.s=8349)),_N_E=e.O()}]);